<!-- BankingandOsSnapshot -->
	<script id="rowTemplateTop" type="text/x-kendo-tmpl">
	  <tr>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:OBLIPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:OBLIEmi#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:CWMPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:CWMEmi#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:PBSLPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:PBSLEmi#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:BTPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:BTEmi#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:TCLPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:TCLEmi#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:DPLLoan#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:DPLMargin#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:DPLTenor#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:DPLROI#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	         #:IntOBLI#
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:ExisPos#</span>
	      </td>
	      <td role="grid-cell" style="text-align: right; background: rgb(238, 238, 238); white-space: normal; white-space: normal; word-break: break-all !important; word-wrap: break-word !important;">
	      	<span>#:Yrp#</span>
	      </td>
	  </tr>
	</script>
<!-- end -->

<script type="text/javascript">
	var URLRender = function(){
		add_url = '?customerid='+r.customerId().split('|')[0]+'&dealno='+r.customerId().split('|')[1]

    linkADForm = '<a target="_blank" href="/accountdetail/default'+add_url+'">Account Detail</a>'
    $('.linkADForm').append(linkADForm)

    linkInternalRTRForm = '<a target="_blank" href="/rtr/internalrtr'+add_url+'">Internal RTR Form</a>'
    $('.linkInternalRTRForm').append(linkInternalRTRForm)

    linkCreditScoreCard = '<a target="_blank" href="/creditscorecard/default'+add_url+'">Credit Score Card</a>'
    $('.linkCreditScoreCard').append(linkCreditScoreCard)

    linkDueDiligence = '<a target="_blank" href="/duediligence/form'+add_url+'">Due Diligence</a>'
    $('.linkDueDiligence').append(linkDueDiligence)

    linkCibilForm = '<a target="_blank" href="/datacapturing/cibilnew'+add_url+'">Cibil Form</a>'
    $('.linkCibilForm').append(linkCibilForm)

    linkKeyFinancialReport = '<a target="_blank" href="/ratio/pdf'+add_url+'">Key Financial Report</a>'
    $('.linkKeyFinancialReport').append(linkKeyFinancialReport)

    linkBankingAnalysis = '<a target="_blank" href="/bankanalysis/default'+add_url+'">Banking Analysis</a>'
    $('.linkBankingAnalysis').append(linkBankingAnalysis)

    linkExternalRepaymentTrack = '<a target="_blank" href="/rtr/default'+add_url+'">External Repayment Track</a>'
    $('.linkExternalRepaymentTrack').append(linkExternalRepaymentTrack)

    linkLoanAprovalReport = '<a target="_blank" href="/loanapproval/default'+add_url+'">Loan Aproval Report</a>'
    $('.linkLoanAprovalReport').append(linkLoanAprovalReport)
  };

	var companyBackground = function(param) {
	    var attr = {
	        topTable: {},
	        topCustomersName: ko.observableArray(),
	        topProducts: ko.observableArray()
	    }

	    attr.topTable.pdDone = param.accountsetupdetails.pdinfo.pddoneby;

	    var pddt = new Date(param.accountsetupdetails.pdinfo.pddate);
	    pddat = moment(pddt).format("DD/MM/YYYY");
	    attr.topTable.pdDate = pddat;

	    attr.topTable.pdPlace = param.accountsetupdetails.pdinfo.pdplace;
	    attr.topTable.personMet = param.accountsetupdetails.pdinfo.personmet;
	    attr.topTable.pdCustomerMargin = param.accountsetupdetails.pdinfo.customermargin + "%";
	    attr.topTable.pdRemarks = param.accountsetupdetails.pdinfo.pdremarks;
	    attr.topTable.pdComments = param.accountsetupdetails.pdinfo.pdcomments;

	    loanapproval.companybackground([]);
	    loanapproval.companybackground.push(attr.topTable);
	    rendercompbacground(loanapproval.companybackground());

	    attr.mostLength = ko.computed(function() {
	        if(attr.topCustomersName().length > attr.topProducts().length)
	            return attr.topCustomersName()
	        else
	            return attr.topProducts()
	    })

	    if(param.borrowerdetails.TopCustomerNames != undefined)
	        attr.topCustomersName(param.borrowerdetails.TopCustomerNames);
	    else
	        attr.topCustomersName(param.borrowerdetails.topcustomernames);

	    if(param.borrowerdetails.ProductNameandDetails != undefined)
	        attr.topProducts(param.borrowerdetails.ProductNameandDetails);
	    else
	        attr.topProducts(param.borrowerdetails.productnameanddetails);

	    return attr
	}

	var createreferencecheckgrid = function(res){
	    $("#referencecheckgrid").html("");
	    $("#referencecheckgrid").kendoGrid({
	        dataSource : {
	            data : res,
	        },
	        columns :
	        [
	            {
	                title : "Source",
	                headerAttributes: { "class": "sub-bgcolor col-sm-2" },
	                field : "source"
	            },
	            {
	                title : "Source Name",
	                headerAttributes: { "class": "sub-bgcolor" },
	                field : "sourcename"
	            },
	            {
	                title : "Reference Check By",
	                headerAttributes: { "class": "sub-bgcolor" },
	                field : "checkby"
	            },
	            {
	                title : "Positive/Negative",
	                headerAttributes: { "class": "sub-bgcolor" },
	                field : "ispositive"
	            },
	            {
	                title : "Brief Feedback Remark",
	                headerAttributes: { "class": "sub-bgcolor" },
	                field : "feedback"
	            },
	        ]
	    });
	}

// KeyParametersandIndicators ----------------------------------------------------
	var createKeyParametersandIndicators = function(norm) {
	    var DataTmp = []

	    var render = function(datas) {
	        _.each(datas.filter(function (d) {
	            return d.ShowInLoanApprovalScreen
	        }), function(data) {
	            if(data.ShowInLoanApprovalScreen == false) {
	                return;
	            }
	            if(data.CalculatedValue != undefined) {
	                var getFixedCalculatedValue = parseFloat((function () {
	                    return (function(val){
	                        if(data.CalculatedValue.ValueType == "percentage")
	                            return val * 100;
	                        return val;
	                    })(data.CalculatedValue.Value)
	                })()).toFixed(2);

	                if(data.CalculatedValue.Value != 0) {
	                    if(data.CalculatedValue.ValueType == "percentage")
	                        data.calculatedvaluetodisplay = getFixedCalculatedValue + "%"
	                    else
	                        data.calculatedvaluetodisplay = getFixedCalculatedValue;
	                } else {
	                    data.calculatedvaluetodisplay = "n/a"
	                }

	                if(data.Operator == "min"){
	                    data.ismet = (getFixedCalculatedValue > data.Value1) ? "Met" : "Not Met";
	                } else if(data.Operator == "max"){
	                    data.ismet = (getFixedCalculatedValue < data.Value1) ? "Met" : "Not Met";
	                } else if(data.Operator == "greater than or equal"){
	                    data.ismet = (getFixedCalculatedValue >= data.Value1) ? "Met" : "Not Met";
	                } else if(data.Operator == "lower than or equal"){
	                    data.ismet = (getFixedCalculatedValue <= data.Value1) ? "Met" : "Not Met";
	                } else if(data.Operator == "equal"){
	                    data.ismet = (getFixedCalculatedValue == data.Value1) ? "Met" : "Not Met";
	                } else if(data.Operator == "between"){
	                    data.ismet = (getFixedCalculatedValue > data.Value1 && getFixedCalculatedValue < data.Value2) ? "Met" : "Not Met";
	                }
	            } else {
	                _.each(columns, function(column){
	                    column.field = column.field.toLowerCase();
	                })
	                data.calculatedvaluetodisplay = "No Internal Rating"
	                data.ismet = "No Internal Rating";
	            }

	            DataTmp.push(data);
	        })

	        $("#gridKeyParametersandIndicators").html("")
	        $("#gridKeyParametersandIndicators").kendoGrid({
	            dataSource : { data: DataTmp },
	            columns: [
					        { title: "Criteria", field: "Criteria", headerAttributes: { "class": "sub-bgcolor" }},
					        { title: "Norm", field: "NormLabel", headerAttributes: { "class": "sub-bgcolor" }, attributes: { "class": "center"} },
					        { title: "Actual", field: "calculatedvaluetodisplay", headerAttributes: { "class": "sub-bgcolor" }, attributes: { "class": "center"} },
					        { title: "Met / Not Met", field: "ismet", headerAttributes: { "class": "sub-bgcolor" }, attributes: { "class": "center"} }

					    ]
	        });
	    }

	    $(function () {
	        ajaxPost("/creditscorecard/getcscdata", getSearchVal(), function(cscData){

	            if(cscData.Data != undefined){
	                var score = _.sum(cscData.Data[0].Data.filter(function (d) {
	                    return d.IsHeader
	                }).map(function (d) {
	                    return kendo.parseFloat(d.WeightScore)
	                }));

	                var rating = (function () {
	                    if (score <= 4.5) {
	                        return "XFL5"
	                    } else if (score < 6) {
	                        return "XFL4"
	                    } else if (score < 7) {
	                        return "XFL3"
	                    } else if (score <= 8.5) {
	                        return "XFL2"
	                    } else {
	                        return "XFL1"
	                    }
	                })();
	                loanapproval.internalrating(rating);

	                ajaxPost("/normmaster/getnormdata", {
	                    Internalrating: rating,
	                    Customerid: filter().CustomerSearchVal(),
	                    Dealno: filter().DealNumberSearchVal()
	                }, function(param) {
	                    render(param.Data);
	                })
	            } else {
	                render(norm);
	            }
	        })
	    })
	}
//= End KeyParametersandIndicators ===============================================

// KeyFinancialRatios ------------------------------------------------------------
	var createKeyFinancialRatios = function(){
		var column = [
      { title: "Name", field: "name", width: 250, headerAttributes: { "class": "sub-bgcolor col-sm-2" }}
    ]

		if( r.FR()[0].ColumnHeader().length > 2 ){
			_.each(r.FR()[0].ColumnHeader(),function(v,i){
			  if(i>0){
			  	column.push({ title: v.replace("(Audited)", ""), field: "v"+i, headerAttributes: { "class": "sub-bgcolor col-sm-2" }})
			  }
			})
		}

    // -------------- LeverageRatios -----------------------------
			var dataLeverageRatios = []
			if ( r.FR()[2].row().length > 2 ){
				_.each(r.FR()[2].row(),function(v,i){
				  var tmp = {}
				  tmp.name = v.rowData[0]
				  if(v.rowData.length > 4){
				    tmp.v1 = v.rowData[1]
				    tmp.v2 = v.rowData[2]
				    tmp.v3 = v.rowData[3]
				    tmp.v4 = v.rowData[4]
				  } else if(v.rowData.length > 3){
				    tmp.v1 = v.rowData[1]
				    tmp.v2 = v.rowData[2]
				    tmp.v3 = v.rowData[3]
				  } else if(v.rowData.length > 2){
				    tmp.v1 = v.rowData[1]
				    tmp.v2 = v.rowData[2]
				  } else{
				  	tmp.v1 = "n/a"
				    tmp.v2 = "n/a"
				  }
				  dataLeverageRatios.push(tmp)
				})
			}
			$("#gridLeverageRatios").html("")
	    $("#gridLeverageRatios").kendoGrid({
	        dataSource : { data: dataLeverageRatios },
	        columns: [{
		      	title:"Leverage Ratios",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End LeverageRatios -------------------------

    // -------------- OperatingRatios -----------------------------
			var dataOperatingRatios = []
			if ( r.FR()[5].row().length > 5 ){
				_.each(r.FR()[5].row(),function(v,i){
					if( i > 3 ){
					  var tmp = {}
					  tmp.name = v.rowData[0]
					  if(v.rowData.length > 4){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					    tmp.v4 = v.rowData[4]
					  } else if(v.rowData.length > 3){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					  } else if(v.rowData.length > 2){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					  } else{
					  	tmp.v1 = "n/a"
					    tmp.v2 = "n/a"
					  }
					  dataOperatingRatios.push(tmp)
					}
				})
			}
			$("#gridOperatingRatios").html("")
	    $("#gridOperatingRatios").kendoGrid({
	        dataSource : { data: dataOperatingRatios },
	        columns: [{
		      	title:"Operating Ratios",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End OperatingRatios -------------------------

    // -------------- CoverageRatios -----------------------------
			var dataCoverageRatios = []
			if ( r.FR()[3].row().length > 1 ){
				_.each(r.FR()[3].row(),function(v,i){
					  var tmp = {}
					  tmp.name = v.rowData[0]
					  if(v.rowData.length > 4){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					    tmp.v4 = v.rowData[4]
					  } else if(v.rowData.length > 3){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					  } else if(v.rowData.length > 2){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					  } else{
					  	tmp.v1 = "n/a"
					    tmp.v2 = "n/a"
					  }
					  dataCoverageRatios.push(tmp)
				})
			}
			$("#gridCoverageRatios").html("")
	    $("#gridCoverageRatios").kendoGrid({
	        dataSource : { data: dataCoverageRatios },
	        columns: [{
		      	title:"Coverage Ratios",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End CoverageRatios -------------------------

    // -------------- LiquidityRatios -----------------------------
			var dataLiquidityRatios = []
			if ( r.FR()[4].row().length > 0 ){
				_.each(r.FR()[4].row(),function(v,i){
					  var tmp = {}
					  tmp.name = v.rowData[0]
					  if(v.rowData.length > 4){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					    tmp.v4 = v.rowData[4]
					  } else if(v.rowData.length > 3){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					  } else if(v.rowData.length > 2){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					  } else{
					  	tmp.v1 = "n/a"
					    tmp.v2 = "n/a"
					  }
					  dataLiquidityRatios.push(tmp)
				})
			}
			$("#gridLiquidityRatios").html("")
	    $("#gridLiquidityRatios").kendoGrid({
	        dataSource : { data: dataLiquidityRatios },
	        columns: [{
		      	title:"Liquidity Ratios",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End LiquidityRatios -------------------------

    // -------------- KeyRatios -----------------------------
			var dataKeyRatios = []
			if ( r.FR()[6].row().length > 4 ){
				_.each(r.FR()[6].row(),function(v,i){
						if(i > 1 && i < 5){
						  var tmp = {}
						  tmp.name = v.rowData[0]
						  if(v.rowData.length > 4){
						    tmp.v1 = "n/a"
						    tmp.v2 = "n/a"
						    tmp.v3 = "n/a"
						    tmp.v4 = v.rowData[4]
						  } else if(v.rowData.length > 3){
						    tmp.v1 = "n/a"
						    tmp.v2 = "n/a"
						    tmp.v3 = v.rowData[3]
						  } else if(v.rowData.length > 2){
						    tmp.v1 = "n/a"
						    tmp.v2 = v.rowData[2]
						  } else{
						  	tmp.v1 = "n/a"
						    tmp.v2 = "n/a"
						  }
						  dataKeyRatios.push(tmp)
					  }
				})
			}
			$("#gridKeyRatios").html("")
	    $("#gridKeyRatios").kendoGrid({
	        dataSource : { data: dataKeyRatios },
	        columns: [{
		      	title:"Key Ratios",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End KeyRatios -------------------------
	}
//= End KeyFinancialRatios =======================================================

// KeyFinancialParameters --------------------------------------------------------
	var createKeyFinancialParameters = function(){
		var column = [
      { title: "Name", field: "name", width: 250, headerAttributes: { "class": "sub-bgcolor col-sm-2" }}
    ]

		if( r.KFI()[0].ColumnHeader().length > 2 ){
			_.each(r.KFI()[0].ColumnHeader(),function(v,i){
			  if(i>0){
			  	column.push({ title: v.replace("(Audited)", ""), field: "v"+i, headerAttributes: { "class": "sub-bgcolor col-sm-2" }})
			  }
			})
		}

		// -------------- PnL -----------------------------
			var dataPnL = []
			if ( r.KFI()[0].row().length > 2 ){
				_.each(r.KFI()[0].row(),function(v,i){
				  if(i != 5 && i != 6){
					  var tmp = {}
					  tmp.name = v.rowData[0]
					  if(v.rowData.length > 4){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					    tmp.v4 = v.rowData[4]
					  } else if(v.rowData.length > 3){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					    tmp.v3 = v.rowData[3]
					  } else if(v.rowData.length > 2){
					    tmp.v1 = v.rowData[1]
					    tmp.v2 = v.rowData[2]
					  } else{
					  	tmp.v1 = "n/a"
					    tmp.v2 = "n/a"
					  }
					  dataPnL.push(tmp)
				  }
				})
			}
			$("#gridPnL").html("")
	    $("#gridPnL").kendoGrid({
	        dataSource : { data: dataPnL },
	        columns: [{
		      	title:"P & L",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End PnL -------------------------

    // -------------- BalanceSheet -----------------------------
			var dataBalanceSheet = []
			if ( r.KFI()[1].row().length > 2 ){
				listArray = [8, 13, 15, 0, 4, 1, 5]
				_.each(listArray,function(v,i){
					var tmp = {}
					tmp.name = r.KFI()[1].row()[v].rowData[0]

					if(v == 8 || v == 0){
						tmp.v1 = " "
				    tmp.v2 = " "
				    tmp.v3 = " "
				    tmp.v4 = " "
					} else{
					  if(r.KFI()[1].row()[v].rowData.length > 4){
					    tmp.v1 = r.KFI()[1].row()[v].rowData[1]
					    tmp.v2 = r.KFI()[1].row()[v].rowData[2]
					    tmp.v3 = r.KFI()[1].row()[v].rowData[3]
					    tmp.v4 = r.KFI()[1].row()[v].rowData[4]
					  } else if(r.KFI()[1].row()[v].rowData.length > 3){
					    tmp.v1 = r.KFI()[1].row()[v].rowData[1]
					    tmp.v2 = r.KFI()[1].row()[v].rowData[2]
					    tmp.v3 = r.KFI()[1].row()[v].rowData[3]
					  } else if(r.KFI()[1].row()[v].rowData.length > 2){
					    tmp.v1 = r.KFI()[1].row()[v].rowData[1]
					    tmp.v2 = r.KFI()[1].row()[v].rowData[2]
					  } else{
					  	tmp.v1 = "n/a"
					    tmp.v2 = "n/a"
					  }
					}
					dataBalanceSheet.push(tmp)
				})
			}
			$("#gridBalanceSheet").html("")
	    $("#gridBalanceSheet").kendoGrid({
	        dataSource : { data: dataBalanceSheet },
	        columns: [{
		      	title:"Balance Sheet",
		      	headerAttributes: { class: "header-bgcolor" },
						columns: column
					}]
	    });
    // -------------- End BalanceSheet -------------------------
	}
//= End KeyFinancialParameters ===================================================

// PromoterandManagementDetails --------------------------------------------------
	var createCibilDetails = function(datass){
		$("#gridCibilDetails").html("");
		$("#gridCibilDetails").kendoGrid({
			dataSource: {
				data:  datass,
				schema:{
					model:{
						id: "Name",
						fields: {
							Name:{editable: true,},
							Designation:{editable: true},
							ShareHolding:{type: "number", editable: true, min: 1, spinner: false},
							CIBILScore:{type: "number", editable: true, min: 1},
							RedFlags:{editable: true},
						}
					}
				}
			},
			columns : [{
	      title:"CIBIL Details",
	      headerAttributes: { class: "header-bgcolor" },
				columns:[
					{
						field: "Name",
						title: "Name",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					},
					{
						field: "CIBILScore",
						title: "CIBIL Score",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					}

				],
			}]
		});
	}

	var createRedFlags = function(){
		$("#gridRedFlags").html("");
		$("#gridRedFlags").kendoGrid({
			dataSource: {
				data:  redflags(),
				schema:{
					model:{
						id: "Name",
						fields: {
							Name:{editable: true,},
							Designation:{editable: true},
							ShareHolding:{type: "number", editable: true, min: 1, spinner: false},
							CIBILScore:{type: "number", editable: true, min: 1},
							RedFlags:{editable: true},
						}
					}
				}
			},
			columns : [{
	      title:"Red Flags",
	      headerAttributes: { class: "header-bgcolor" },
				columns:[
					{
						field: "Name",
						title: "Name",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 50,
					},
					{
						field: "RedFlags",
						title: "Details",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					}

				],
			}]
		});
	}

	var createMainPromotorDetails = function(datass){
		_.each(datass, function(v,i){
			datass[i].countrealestateposition = v.realestateposition.reduce((a, b) => a + b, 0)
		})

		$("#gridMainPromotorDetails").html("");
		$("#gridMainPromotorDetails").kendoGrid({
			dataSource: {
				data:  datass,
				schema:{
					model:{
						id: "Name",
						fields: {
							Name:{editable: true,},
							Designation:{editable: true},
							ShareHolding:{type: "number", editable: true, min: 1, spinner: false},
							CIBILScore:{type: "number", editable: true, min: 1},
							RedFlags:{editable: true},
						}
					}
				}
			},
			columns : [{
	      title:"Main Promotor Details",
	      headerAttributes: { class: "header-bgcolor" },
				columns:[
					{
						field: "promotername",
						title: "Main Promoter Names",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 200,
					},
					{
						field: "experienceinsamelineofbusiness",
						title: "Experience in the same line of business",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					},
					{
						field: "educationalqualificationofmainpromoter",
						title: "Educational Qualification of main promoter",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 250,
					},
					{
						field: "resiownershipstatus",
						title: "Residence Ownership Status",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					},
					{
						field: "officeownershipstatus",
						title: "Office Ownership Status",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					},
					{
						field: "countrealestateposition",
						title: "Real Estate Position (Rs Lacs)",
						headerAttributes: { "class": "sub-bgcolor" },
						width: 100,
					},
				],
			}]
		});
	}
//= End PromoterandManagementDetails =============================================

// BankingandOsSnapshot ----------------------------------------------------------
	function createBankingandOsSnapshot(res){
		createBankingDetails(res)
		createOutstandingDebt();
	}

	var createBankingDetails = function(res){
	    for(var i in res){
	        res[i]["Month"] = moment(res[i]["Month"].split("T")[0]).format("MMM-YYYY")
	    }
	    $("#gridBankingDetails").html("");
	    $("#gridBankingDetails").kendoGrid({
	        dataSource : {
				data : res,
	            aggregate: [
	                { field: "TotalCredit", aggregate: "sum" },
	                { field: "TotalDebit", aggregate: "sum" },
	                { field: "NoOfDebit", aggregate: "sum" },
	                { field: "NoOfCredit", aggregate: "sum" },
	                { field: "OwCheque", aggregate: "sum" },
	                { field: "IwCheque", aggregate: "sum" },
	                { field: "Utilization", aggregate: "average" },
	                { field: "ImpMargin", aggregate: "sum" },
	                { field: "OwReturnPercentage", aggregate: "average" },
	                { field: "LwReturnPercentage", aggregate: "average" },
	                { field: "DrCrReturnPercentage", aggregate: "average" },
	            ]
			},
	        columns : [{
	            title:"Banking Details",
	            headerAttributes: { class: "header-bgcolor" },
	            columns:[{
	                title:"Months",
	                field:"Month",
	                headerAttributes: { class: "sub-bgcolor" },
	                format:"{0:dd-MMM-yyyy}",
	                footerTemplate: 'Total'
	            }, {
	                title:"Monthly Credits",
	                field:"TotalCredit",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'> #= kendo.toString(sum, 'n0') # </div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(TotalCredit,'N0') #"
	            }, {
	                title:"Monthly Debits",
	                field:"TotalDebit",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(TotalDebit,'N0') #"
	            }, {
	                title:"No. Of Debits",
	                field:"NoOfDebit",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(NoOfDebit,'N0') #"
	            }, {
	                title:"No. Of Credits",
	                field:"NoOfCredit",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(NoOfCredit,'N0') #"
	            }, {
	                title:"O/W Cheque Returns",
	                field:"OwCheque",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(OwCheque,'N0') #"
	            }, {
	                title:"I/W Cheque Returns",
	                field:"IwCheque",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(IwCheque,'N0') #"
	            }, {
	                title:"Utilization %",
	                field:"Utilization",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["average"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(average, 'P1') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(Utilization,'P1') #"
	            }, {
	                title:"Imp Margin",
	                field:"ImpMargin",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(sum, 'n0') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(ImpMargin,'N2') #"
	            }, {
	                title:"O/W Return %",
	                field:"OwReturnPercentage",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(average, 'P1') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(OwReturnPercentage,'P1') #"
	            }, {
	                title:"I/w return %",
	                field:"LwReturnPercentage",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(average, 'P1') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(LwReturnPercentage,'P1') #"
	            }, {
	                title:"Dr./Cr. Ratio",
	                field:"DrCrReturnPercentage",
	                headerAttributes: { class: "sub-bgcolor" },
	                aggregates: ["sum"],
	                footerTemplate: "<div style='text-align: right'>#= kendo.toString(average, 'N2') #</div>",
	                attributes:{ "style": "text-align:right" },
	                template : "#: kendo.toString(DrCrReturnPercentage,'N2') #"
	            }]
	        }],
	    });
	}

	var createOutstandingDebt = function(){
	  var topgriddata = [{
			OBLIPos : 0,
			OBLIEmi : 0,
			CWMPos : 0,
			CWMEmi : 0,
			PBSLPos : 0,
			PBSLEmi :0,
			BTPos : 0,
			BTEmi : 0,
			TCLPos : 0,
			TCLEmi : 0,
			DPLLoan : 0,
			DPLMargin : 0,
			DPLTenor : 0,
			DPLROI : 0,
	      	IntOBLI : 0,
			ExisPos : 0,
			Yrp : 0
		}];

		callData = {}
	  callData["customerid"] = filter().CustomerSearchVal()
	  callData["dealno"] = filter().DealNumberSearchVal()

	  ajaxPost("/rtr/getdatabottomgrid",callData, function(res){

	      if(res.message != "") {
	          swal("Warning","Data Outstanding Debt Not Found","warning");
	          return
	      }

	      topgriddata[0].OBLIPos = res.data[1].summary.TotalObligationPOS
	      topgriddata[0].OBLIEmi = res.data[1].summary.TotalObligationEMI
	      topgriddata[0].CWMPos = res.data[1].summary.CloseWithin3MonthPOS
	      topgriddata[0].CWMEmi = res.data[1].summary.CloseWithin3MonthEMI.toFixed(2)
	      topgriddata[0].PBSLPos = res.data[1].summary.PBSLPOS
	      topgriddata[0].PBSLEmi = res.data[1].summary.PBSLEMI
	      topgriddata[0].BTPos = res.data[1].summary.BalancePOS
	      topgriddata[0].BTEmi = res.data[1].summary.BalanceEMI
	      topgriddata[0].TCLPos = res.data[1].summary.TCLPOS
	      topgriddata[0].TCLEmi = res.data[1].summary.TCLEMI.toFixed(2)
	      topgriddata[0].DPLMargin = res.data[1].summary.DPLCustMargin
	      topgriddata[0].DPLLoan = res.data[1].summary.DPLAmountOfLimit
	      topgriddata[0].DPLTenor = res.data[1].summary.DPLTenor
	      topgriddata[0].DPLROI = res.data[1].summary.DPLROI
	      topgriddata[0].IntOBLI = res.data[1].summary.X10IntObligation
	      topgriddata[0].ExisPos = res.data[1].summary.X10ExistingPOS
	      topgriddata[0].Yrp = res.data[1].summary.YearlyRepayment

	      $("#gridOutstandingDebt").kendoGrid({
					dataSource : {
						data : topgriddata
					},
					columns : [{
	            title:"Outstanding Debt",
	            headerAttributes: { class: "header-bgcolor" },
							columns : [
								{ title : "Total Obligations",
									columns : [
										{ field : "OBLIPos", headerAttributes: { "class": "sub-bgcolor" }, title : "POS (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
										{ field : "OBLIEmi", headerAttributes: { "class": "sub-bgcolor" }, title : "EMI (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
									],
									width: 100
								 },
								{ title : "Close Within 3 Month",
									columns : [
										{ field : "CWMPos", headerAttributes: { "class": "sub-bgcolor" }, title : "POS (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
										{ field : "CWMEmi", headerAttributes: { "class": "sub-bgcolor" }, title : "EMI (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
									],
									width: 100
								 },
								{ title : "P.B.S.L",
									columns : [
										{ field : "PBSLPos", headerAttributes: { "class": "sub-bgcolor" }, title : "POS (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
										{ field : "PBSLEmi", headerAttributes: { "class": "sub-bgcolor" }, title : "EMI (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
									],
									width: 100
								},
								{ title : "Balance Transfer",
									columns : [
										{ field : "BTPos", headerAttributes: { "class": "sub-bgcolor" }, title : "POS (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
										{ field : "BTEmi", headerAttributes: { "class": "sub-bgcolor" }, title : "EMI (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
									],
									width: 100
								},
								{ title : "Total Considered Liability",
									columns : [
										{ field : "TCLPos", headerAttributes: { "class": "sub-bgcolor" }, title : "POS (Rs lacs)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' }  },
										{ field : "TCLEmi", title : "EMI (Rs lacs)", width: 100, headerAttributes: { "class": "sub-bgcolor" },attributes: { style: 'background: rgb(238, 238, 238)' }  },
									],
									width: 60
								 },
								// { title : "Detail of Proposed Loan",
								// 	// columns : [
								// 	// 	{field : "DPLLoan", headerAttributes: { "class": "sub-bgcolor" }, title : "Proposed Amount of Limit (Rs Lacs)", width: 190, attributes: { style: 'background: rgb(238, 238, 238)' } },
								// 	// 	{field : "DPLMargin", headerAttributes: { "class": "sub-bgcolor" }, title : "Cust. Margin", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' } },
								// 	// 	{field : "DPLTenor", headerAttributes: { "class": "sub-bgcolor" }, title : "Tenor (month)", width: 90, attributes: { style: 'background: rgb(238, 238, 238)' } },
								// 	// 	{field : "DPLROI", headerAttributes: { "class": "sub-bgcolor" }, title : "ROI(%)", width: 70, attributes: { style: 'background: rgb(238, 238, 238)' } },
					   //  //            {field : "IntOBLI", headerAttributes: { "class": "sub-bgcolor" }, title : "X10 Int. Obligation (Rs)" , width: 130, attributes: { style: 'background: rgb(238, 238, 238)' } },
								// 	// ],
								// 	width: 100
								// },
								{field : "IntOBLI", title : "X10 Int. Obligation (Rs)" , width: 130, attributes: { style: 'background: rgb(238, 238, 238)' } },
								// { title : "X10 Existing Pos (Rs)", field : "ExisPos", width: 130, attributes: { style: 'background: rgb(238, 238, 238)' }  },
								{ title : "External Yearly Repayment (Rs. Lacs) incl. X10 Int" , field : "Yrp", width: 130, attributes: { style: 'background: rgb(238, 238, 238)' } },
								{ title : "xternal Yearly Repayment (Rs. Lacs)", width: 130, field : "SumBounces", attributes: { style: 'background: rgb(238, 238, 238)', class: "wrap" } },
								{ title : "EMI Bounces Last 6 Months", width: 130, field : "SumExtenalYearly", attributes: { style: 'background: rgb(238, 238, 238)' } },
							],
					}],
					rowTemplate: kendo.template($("#rowTemplateTop").html())
				});
	  })
	}
//= End BankingandOsSnapshot =====================================================

</script>
<style type="text/css">
	h3{
		font-size: 16px;
	}
	.k-grid-footer{
		padding: 0 !important;
	}
  .no-padding{
      padding-left : 0px;
      padding-right : 0px;
  }
  .summary{
      padding-left : 10px;
  }

  .payment-table tr td {
  	white-space: nowrap !important;
  }
</style>
<ul class="collapsible" data-collapsible="accordion" id="ldb">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Loan Detail<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				                <table class="custom-label table-bordered">
				                    <tr>
				                        <td class="col-sm-2 text-bold">Proposed Limit Amount (Rs.Lacs)</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.proposedLimitAmount"></span></td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">If Existing Customer</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.ifExistingCustomer"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">Proposed Rate Of Interest (ROI)</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.proposedROI"></span></td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">If Yes, Existing Limit Amount</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.ifYesExistingLimitAmount"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">Proposed Pro Fee %</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.proposedProFee"></span></td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">Existing ROI</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.existingROI"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">Limit Tenor (Months)</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.limitTenor"></span></td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">Existing Processing Fee</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.existingProcessingFee"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">PO Backed</td>
				                        <td class="col-sm-4" data-bind="text:loanApproval.loanDetail.poBacked">&nbsp;</td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">First Agreement Date</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.firstAgreementDate"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">Project PO Value</td>
				                        <td class="col-sm-4" data-bind="text:loanApproval.loanDetail.projectPOValue">&nbsp;</td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">Vintage With X10 (Months)</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.vintageWithX10"></span></td>
				                    </tr>
				                    <tr>
				                        <td class="col-sm-2 text-bold">Expected Payment from Project (120 Days)</td>
				                        <td class="col-sm-4" data-bind="text:loanApproval.loanDetail.expectedPayment">&nbsp;</td>
				                        <td class="table-divider"></td>
				                        <td class="col-sm-2 text-bold">Recent Agreement Date</td>
				                        <td class="col-sm-4"><span data-bind="text:loanApproval.loanDetail.recentAgreementDate"></span></td>
				                    </tr>
					                    <tr>
				                        <td class="col-sm-2 text-bold">X10 Interest Obligation (Rs Lacs)</td>
				                        <td class="col-sm-4" data-bind="text:loanApproval.loanDetail.x10Obligo">&nbsp;</td>
				                        <td class="table-divider"></td>
				                    </tr>
				                </table>
		                    <br>
		                    <div>More Detail : <span class="linkADForm"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="ptb">
  <li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Payment Track<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid k-widget">
			                <table class="payment-table">
			                    <thead class="k-grid-header">
			                        <tr>
			                            <th colspan="5" class="sub-bgcolor k-header ">
			                                Distributor / Vendor Payment Track
			                            </th>
			                            <th class="table-divider" rowspan="6"></th>
			                            <th colspan="2" class="sub-bgcolor k-header ">
			                                X10 Finance Existing Customer Payment Track
			                            </th>
			                        </tr>
			                    </thead>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Max Delay Days</td>
			                        <td class="col-sm-1 datacol right"><span data-bind="text:loanApproval.paymentTrack.maxdelaydays"></span></td>
			                        <td rowspan="5"></td>
			                        <td class="col-sm-2 text-bold">Average Transaction Weigthed Payment Delay Days</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.averagetransactionpaymentdelay"></span></td>
			                        <td rowspan="5"></td>
			                        <td class="col-sm-3 text-bold">Average Utilization Of Existing Limit</td>
			                        <td class="col-sm-1 right" style="min-width: 100px;"><span>0</span></td>
			                    </tr>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Max Payment Days</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.maxpaymentdays"></span></td>
			                        <td class="col-sm-2 text-bold">Standard Deviation</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.delaystandarddeviation"></span></td>
			                        <td class="col-sm-2 text-bold">Max DPD in Closed Loan in Days</td>
			                        <td class="col-sm-1 right"><span>0</span></td>
			                    </tr>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Average Delay Days</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.averagedelaydays"></span></td>
			                        <td class="col-sm-2 text-bold">Average Transaction Weighted Payment Days</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.averagetransactionpayment"></span></td>
			                        <td class="col-sm-2 text-bold">Number Of Instance Of Delay Payment of Princial Repayment</td>
			                        <td class="col-sm-1 right"><span>0</span></td>
			                    </tr>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Standard Deviation</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.standarddeviation"></span></td>
			                        <td class="col-sm-2 text-bold">Standard Deviation</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.daystandarddeviation"></span></td>
			                        <td class="col-sm-2 text-bold">Number Of Instances Of Early Closure Of Principal Repayment</td>
			                        <td class="col-sm-1 right"><span>0</span></td>
			                    </tr>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Average Payment Days</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.averagepaymentdays"></span></td>
			                        <td class="col-sm-2 text-bold">Amount Of Business Done in Last 12 Months With Lead Distributor in Lacs</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.amountofbusiness"></span></td>
			                        <td class="col-sm-2 text-bold">Number Of Instances If Payment On Due Date</td>
			                        <td class="col-sm-1 right"><span>0</span></td>
			                    </tr>
			                    <tr>
			                        <td class="col-sm-2 text-bold">Average Delay Days (Highest)</td>
			                        <td class="col-sm-1 right"><span data-bind="text:loanApproval.paymentTrack.highestAverageDelay"></span></td>
			                        <td class="col-sm-2 text-bold" style="border: none;"></td>
			                        <td class="col-sm-1 right" style="border: none;"></td>
			                        <td class="col-sm-2 text-bold" style="border: none;"></td>
			                        <td class="col-sm-1 right" style="border: none;"></td>
			                    </tr>
			                </table>
			                <br>
			                <div>More Detail : <span class="linkADForm"></span> , <span class="linkInternalRTRForm"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="bdb">
  <li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Borrower Details<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
        <div class="k-grid">
        		<div class="panel">
        			<div class="panel-body">
        				<table class="custom-label table-bordered">
		                <tr>
		                    <td class="col-sm-2 text-bold">Business Segment</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.customersegmentclasification"></span></td>
		                    <td class="table-divider"></td>
		                    <td class="col-sm-2 text-bold">External Rating</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.externalrating"></span></td>
		                </tr>
		                <tr>
		                    <td class="col-sm-2 text-bold">Business Since</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.datebusinessstarted"></span></td>
		                    <td class="table-divider"></td>
		                    <td class="col-sm-2 text-bold">Dependence on suppliers</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.dependeceonsuppliers"></span></td>
		                </tr>
		                <tr>
		                    <td class="col-sm-2 text-bold">Diversification: no. of clients / customers</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.diversificationcustomers"></span></td>
		                    <td class="table-divider"></td>
		                    <td class="col-sm-2 text-bold">Mgt - One Man / Board based</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.borrowerDetails.management"></span></td>
		                </tr>
		            </table>
        			</div>
        		</div>

            <div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Business Mix
								</h3>
							</div>
							<div class="panel-body">
								<div class="col-sm-6">
									<table>
	                  <thead class="k-grid-header">
	                      <tr>
	                          <th colspan="2" class="sub-bgcolor k-header">Customer Business Mix</th>
	                      </tr>
	                  </thead>
	                  <tr>
	                      <td class="col-sm-2 text-bold">Stock & Sell - in %</td>
	                      <td class="col-sm-2 right"><span data-bind="text:loanApproval.borrowerDetails.businessMix.stocksell"></span>
	                      </td>
	                  </tr>
	                  <tr>
	                      <td class="col-sm-2 text-bold">B2B - Govt.- in %</td>
	                      <td class="col-sm-2 right"><span data-bind="text:loanApproval.borrowerDetails.businessMix.govt"></span></td>
	                  </tr>
	                  <tr>
	                      <td class="col-sm-2 text-bold">B2B - Corporate  - in %</td>
	                      <td class="col-sm-2 right"><span data-bind="text:loanApproval.borrowerDetails.businessMix.corporate"></span></td>
	                  </tr>
	              	</table>
								</div>
								<div class="col-sm-6">
									<table>
	                  <thead class="k-grid-header">
	                      <tr>
	                          <th colspan="2" class="sub-bgcolor k-header">Distributor Business Mix</th>
	                      </tr>
	                  </thead>
	                  <tbody data-bind="foreach: loanApproval.borrowerDetails.businessMix.distributorMix.data">
	                  	<tr>
	                  		<td class="col-sm-2 text-bold" data-bind="text: Label"></td>
	                  		<td class="col-sm-2 right" data-bind="text: Result"></td>
	                  	</tr>
	                  </tbody>
	              	</table>
								</div>
	              <div class="col-md-12">
	              	<br>
	              	<div>More Detail : <span class="linkADForm"></span></div>
	              </div>
							</div>
						</div>

        </div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="rrb">
  <li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Ratings and References<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
        <div class="k-grid">
            <div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Ratings
								</h3>
							</div>
							<div class="panel-body">
								<table class="custom-label table-bordered">
		                <tr>
		                    <td class="col-sm-2 text-bold">Industry & Business Risk</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.IndustryAndBusiness"></span></td>
		                    <td class="table-divider"></td>
		                    <td class="col-sm-2 text-bold">Management / Promoters Risk</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.ManagementPromotorsRisk"></span></td>
		                </tr>
		                <tr>
		                    <td class="col-sm-2 text-bold">Financial Risk</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.FinancialRisk"></span></td>
		                    <td class="table-divider"></td>
		                    <td class="col-sm-2 text-bold">Banking Risk</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.BankingRisk"></span></td>
		                </tr>
		                <tr>
		                    <td class="col-sm-2 text-bold">Overall Score</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.OverallScore"></span></td>
		                		<td class="table-divider"></td>
		                		<td class="col-sm-2 text-bold">Internal Rating</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.InternalRating"></span></td>
		                </tr>
		                <tr>
		                		<td class="col-sm-2 text-bold">External Rating</td>
		                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.AD.ExternalRating"></span></td>
		                </tr>
		            </table>
		            <br>
		            <div>More Detail : <span class="linkADForm"></span> , <span class="linkCreditScoreCard"></span></div>
							</div>
						</div>
						<div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Commercial CIBIL Assessment
								</h3>
							</div>
							<div class="panel-body">
	              <table class="custom-label table-bordered">
	              	<tr>
                    <td class="col-sm-2 text-bold">Rating</td>
                    <td class="col-sm-4"><span data-bind="text:loanApproval.ratingRef.Cibil.Rating"></span></td>
                    <td class="table-divider"></td>
                    <td class="col-sm-2 text-bold" style="border: none;"></td>
                    <td class="col-sm-4 non-border" style="border: none;"></td>
	                </tr>
	              </table>
	              <br>
	              <div>More Detail : <span class="linkCibilForm"></span></div>
							</div>
						</div>
						<div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Background Check
								</h3>
							</div>
							<div class="panel-body">
								<script type="text/html" id="topcust-product-template">
								    <!-- ko foreach: loanApproval.companyBackgroundData().mostLength -->
								        <tr>
								            <!-- ko if: $index() == 0 -->
								                <td class="col-sm-2 text-center text-bold" data-bind="attr: { rowspan: loanApproval.companyBackgroundData().mostLength().length }">
								                    Top Customers Name
								                </td>
								                <td class="col-sm-4" data-bind="text: loanApproval.companyBackgroundData().topCustomersName()[$index()]"></td>
								                <td class="col-sm-2 text-center text-bold" data-bind="attr: { rowspan: loanApproval.companyBackgroundData().mostLength().length }">
								                    Products
								                </td>
								                <td class="col-sm-4" data-bind="text: loanApproval.companyBackgroundData().topProducts()[$index()]"></td>
								            <!-- /ko -->
								            <!-- ko ifnot: $index() == 0 -->
								                <td class="col-sm-4" data-bind="text: loanApproval.companyBackgroundData().topCustomersName()[$index()]"></td>
								                <td class="col-sm-4" data-bind="text: loanApproval.companyBackgroundData().topProducts()[$index()]"></td>
								            <!-- /ko -->
								        </tr>
								    <!-- /ko -->
								</script>

								<div class="container-fluid no-padding">
								    <div class="row">
								        <div class="col-sm-12">
								            <div id="compbackgrid"></div>
								        </div>
								    </div>
								    <br>
								    <div class="row">
								        <div class="col-sm-12">
								            <div class="k-grid">
								                <table class="table-bordered" style="word-break: break-word" data-bind="template: { name: 'topcust-product-template' }">
								                </table>
								            </div>
								        </div>
								    </div>
								    <div class="row">
								        <div class="col-sm-12">
								            <div class="k-grid">
								                <table class="table-bordered">
								                    <tr>
								                        <td class="col-sm-2 center text-bold">Expansion Plan</td>
								                        <td class="col-sm-4" data-bind="text:loanapproval.expansionplan"></td>
								                        <td class="col-sm-2 center text-bold">Comments On Financial</td>
								                        <td class="col-sm-4" data-bind="text:loanapproval.commentfinance"></td>
								                    </tr>
								                </table>
								            </div>
								        </div>
								    </div>
								</div>
								<br>
								<div>More Detail : <span class="linkADForm"></span></div>
							</div>
						</div>
						<div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Reference Check
								</h3>
							</div>
							<div class="panel-body">
	              <div class="container-fluid no-padding">
								    <div class="row">
								        <div class="col-sm-12">
								            <div class="k-grid col-sm-6 no-padding">
								                <table class="table-bordered">
								                    <tr>
								                        <td class="col-sm-4">Market Reference</td>
								                        <td class="col-sm-8">
								                            <center><span data-bind="text:loanapproval.marketref"></span></center>
								                        </td>
								                    </tr>
								                </table>
								            </div>
								        </div>
								    </div>
								    <div class="row">
								        <div class="col-sm-12">
								            <div id="referencecheckgrid"></div>
								        </div>
								    </div>
								</div>
								<br>
	              <div>More Detail : <span class="linkADForm"></span></div>
							</div>
						</div>
						<div class="panel">
							<div class="panel-heading">
								<h3 class="no-margin">
									Compliance & Verifications
								</h3>
							</div>
							<div class="panel-body">
								<div class="container-fluid no-padding">

									<div id="gridverification0"></div>
									&nbsp;
									<div id="gridDefaulterList0"></div>

								</div>

								<br>
								<div>More Detail : <span class="linkDueDiligence"></span></div>
							</div>
						</div>
        </div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="kpib">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Key Parameters & Indicators<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				                <div class="container-fluid no-padding">
												    <div class="row">
												        <div class="col-sm-12">
												            <div id="gridKeyParametersandIndicators">
												            </div>
												        </div>
												    </div>
												</div>
		                    <br>
		                    <div>More Detail : <span class="linkKeyFinancialReport"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="kfrb">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Key Financial Ratios<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				                <div class="container-fluid no-padding">
												    <div class="row">
												        <div class="col-sm-12" style="padding-bottom: 10px">
												        	<div class="col-sm-6 no-padding">
												        		<div id="gridLeverageRatios"></div>
												        	</div>
												        	<div class="col-sm-6" style="padding-right: 0">
												        		<div id="gridOperatingRatios"></div>
												        	</div>
												        </div>
												        <br>
												        <div class="col-sm-12" style="padding-bottom: 10px">
												        	<div class="col-sm-6 no-padding">
												        		<div id="gridCoverageRatios"></div>
												        	</div>
												        	<div class="col-sm-6" style="padding-right: 0">
												        		<div id="gridLiquidityRatios"></div>
												        	</div>
												        </div>
												        <div class="col-sm-12">
												        	<div id="gridKeyRatios"></div>
												        </div>
												    </div>
												</div>
		                    <br>
		                    <div>More Detail : <span class="linkKeyFinancialReport"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="kfpb">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Key Financial Parameters<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				                <div class="container-fluid no-padding">
												    <div class="row">
											        <div class="col-sm-12">
											        	<div class="col-sm-6 no-padding">
											        		<div id="gridPnL"></div>
											        	</div>
											        	<div class="col-sm-6" style="padding-right: 0">
											        		<div id="gridBalanceSheet"></div>
											        	</div>
											        </div>
												    </div>
												</div>
		                    <br>
		                    <div>More Detail : <span class="linkKeyFinancialReport"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="pmdb">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Promoter & Management Details<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				            		<div id="gridCibilDetails"></div>
				            		<br>
				            		<div>More Detail : <span class="linkCibilForm"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
				<br><br>
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				            		<div id="gridRedFlags"></div>
                				<br>
                				<div>More Detail : <span class="linkLoanAprovalReport"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
				<br><br>
				<div class="container-fluid">
				    <div class="row">
				        <div class="col-sm-12">
				            <div class="k-grid">
				            		<div id="gridMainPromotorDetails"></div>
                				<br>
                				<div>More Detail : <span class="linkADForm"></span></div>
				            </div>
				        </div>
				    </div>
				</div>
      </div>
    </div>
  </li>
</ul>

<ul class="collapsible" data-collapsible="accordion" id="bosb">
	<li>
    <div class="collapsible-noreplace header-bgcolor active"><i class="fa fa-list"></i>Banking & O/S Snapshot<i class="fa fa-chevron-down pull-right"></i></div>
    <div class="collapsible-body row">
      <div class="col-sm-12">
				<div class="container-fluid">
			    <div class="row">
		        <div class="col-sm-12">
	            <div class="k-grid k-widget">
                <div id="gridOutstandingDebt" ></div>
              	<br>
              	<div>More Detail : <span class="linkExternalRepaymentTrack"></span></div>
	            </div>
		        </div>
			    </div>
				</div>
				<br><br>
				<div class="container-fluid">
			    <div class="row">
						<div class="col-sm-12">
	            <div class="k-grid k-widget">
                <div id="gridBankingDetails" ></div>
                <br>
                <div>More Detail : <span class="linkBankingAnalysis"></span></div>
	            </div>
		        </div>
		      </div>
		    </div>
      </div>
    </div>
  </li>
</ul>